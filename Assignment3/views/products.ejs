<%- include('partials/header') %>

<section class="page-header">
  <div class="container">
    <h1 class="page-title">All Gaming Cards</h1>
    <p class="page-subtitle">Browse our full collection with filters and pagination.</p>
  </div>
</section>

<section class="prizes-section">
  <div class="container">
    <form class="filter-bar" method="get" action="/products">
      <div class="form-group-inline">
        <label for="category">Category</label>
        <select id="category" name="category">
          <option value="all" <%= selectedCategory === 'all' ? 'selected' : '' %>>All</option>
          <% if (categories && categories.length) { %>
            <% categories.forEach(function(cat) { %>
              <option value="<%= cat %>" <%= selectedCategory === cat ? 'selected' : '' %>><%= cat %></option>
            <% }); %>
          <% } %>
        </select>
      </div>

      <div class="form-group-inline">
        <label for="minPrice">Min Price</label>
        <input id="minPrice" type="number" name="minPrice" step="0.01" value="<%= minPrice %>" />
      </div>

      <div class="form-group-inline">
        <label for="maxPrice">Max Price</label>
        <input id="maxPrice" type="number" name="maxPrice" step="0.01" value="<%= maxPrice %>" />
      </div>

      <button type="submit" class="btn-primary">Apply Filters</button>
    </form>

    <div class="prizes-container">
      <% if (products && products.length) { %>
        <% products.forEach(function(product) { %>
          <div class="prize-card">
            <div class="prize-image">
              <img src="<%= product.image %>" alt="<%= product.name %>" />
            </div>
            <div class="prize-content">
              <h3><%= product.name %></h3>
              <p><%= product.description %></p>
              <p>
                <strong>Rarity:</strong>
                <span class="badge-rarity"><%= product.rarity %></span>
              </p>
              <p class="price-tag">$<%= product.price.toFixed(2) %></p>
              <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px;">
                <a href="/products/<%= product._id %>" class="btn-prize">View Details</a>
                <form action="/cart/add" method="POST" style="display: inline;">
                  <input type="hidden" name="productId" value="<%= product._id %>" />
                  <button type="submit" class="btn-primary">Add To Cart</button>
                </form>
              </div>
            </div>
          </div>
        <% }); %>
      <% } else { %>
        <p>No products match your filters.</p>
      <% } %>
    </div>

    <% if (totalPages && totalPages > 1) { %>
      <div class="pagination">
        <% for (let p = 1; p <= totalPages; p++) { %>
          <% const isActive = p === currentPage; %>
          <% const params = new URLSearchParams({ 
                page: String(p), 
                category: selectedCategory || 'all', 
                minPrice: minPrice || '', 
                maxPrice: maxPrice || '' 
              }).toString(); %>
          <% if (isActive) { %>
            <span class="active-page"><%= p %></span>
          <% } else { %>
            <a href="/products?<%= params %>"><%= p %></a>
          <% } %>
        <% } %>
      </div>
    <% } %>
  </div>
</section>

<%- include('partials/footer') %>


